{% extends 'base.html' %}
{% block title %}Geytoris - Produits{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- Logo et titre -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 text-center text-md-start">
    <img src="{{ url_for('static', filename='logo_geytoris.png') }}" alt="Geytoris Logo" height="60" class="mb-3 mb-md-0">
    <h2 class="fw-bold fs-5 text-uppercase mb-0" style="color: #343a40;">Gestion des produits</h2>
  </div>

  <!-- Formulaire d'ajout -->
  <div class="card shadow-lg mb-4 border-0 rounded-4">
    <div class="card-body">
      <h4 class="text-center mb-4 fw-bold" style="color: #e0a800;">Ajouter un nouveau produit</h4>

      <form method="POST" action="/ajouter" class="row g-4">
        <div class="col-12 col-md-6 col-lg-3">
          <label class="form-label">Nom du produit</label>
          <input type="text" class="form-control" name="nom" required>
        </div>
        <div class="col-12 col-md-6 col-lg-3">
          <label class="form-label">Description</label>
          <input type="text" class="form-control" name="description">
        </div>
        <div class="col-12 col-md-6 col-lg-3">
          <label class="form-label">Quantité</label>
          <input type="number" class="form-control" name="quantite" min="1" required>
        </div>
        <div class="col-12 col-md-6 col-lg-3">
          <label class="form-label">Prix d'achat (FCFA)</label>
          <input type="number" step="0.01" class="form-control" name="prix_achat" required>
        </div>
        <div class="col-12 col-md-6 col-lg-3">
          <label class="form-label">Prix de vente (FCFA)</label>
          <input type="number" step="0.01" class="form-control" name="prix_vente" required>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
          <label class="form-label">Fournisseur</label>
          <select class="form-select" name="fournisseur_id">
            <option value="" disabled {% if not fournisseur_id_selectionne %}selected{% endif %}>-- Sélectionner --</option>
            {% for fournisseur in fournisseurs %}
            <option value="{{ fournisseur.id }}" {% if fournisseur_id_selectionne == fournisseur.id|string %}selected{% endif %}>{{ fournisseur.nom }}</option>
            {% endfor %}
          </select>
          <small><a href="{{ url_for('ajouter_fournisseur') }}">Nouveau fournisseur</a></small>
        </div>
        <div class="col-12 text-end">
          <button type="submit" class="btn btn-outline-success px-4">Ajouter</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Recherche et bouton vente -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-stretch gap-3 mb-4">
    <input type="search" id="recherche" class="form-control" placeholder="🔍 Rechercher un produit...">
    <a href="{{ url_for('effectuer_vente') }}" class="btn fw-bold text-white" style="background-color: #e0a800; white-space: nowrap;">🛒 Effectuer une vente</a>
  </div>

  <!-- Table produits -->
  <div id="resultats-produits">
    {% include 'partials/_table_produits.html' %}
  </div>
</div>

<script>
document.getElementById('recherche').addEventListener('input', function () {
  const recherche = this.value;
  fetch(`/rechercher_produits?q=${encodeURIComponent(recherche)}`)
    .then(response => response.text())
    .then(html => {
      document.getElementById('resultats-produits').innerHTML = html;
    });
});
</script>

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.form-supprimer-produit').forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const nom = this.dataset.nom;

      Swal.fire({
        title: 'Êtes-vous sûr ?',
        text: `Le produit "${nom}" sera définitivement supprimé.`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler'
      }).then((result) => {
        if (result.isConfirmed) {
          this.submit();
        }
      });
    });
  });
});
</script>
{% endblock %}

{% endblock %}
