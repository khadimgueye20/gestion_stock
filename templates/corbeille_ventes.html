{% extends 'base.html' %}

{% block title %}Corbeille des Ventes{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">üóëÔ∏è Ventes supprim√©es (corbeille)</h2>

  <a href="{{ url_for('historique') }}" class="btn btn-outline-secondary mb-4">
    ‚Üê Retour √† l‚Äôhistorique
  </a>

  {% if ventes %}
    <table class="table table-bordered table-striped text-center">
      <thead>
        <tr>
          <th>ID</th>
          <th>Produit</th>
          <th>Quantit√©</th>
          <th>Date de vente</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for vente in ventes %}
        <tr>
          <td>{{ vente.id }}</td>
          <td>{{ vente.produit.nom }}</td>
          <td>{{ vente.quantite }}</td>
          <td>{{ vente.date_vente.strftime('%d/%m/%Y √† %H:%M') }}</td>
          <td>
            <!-- Restaurer -->
            <form action="{{ url_for('restaurer_vente', id=vente.id) }}" method="POST" class="d-inline">
              <button type="submit" class="btn btn-success btn-sm">Restaurer</button>
            </form>

            <!-- Suppression d√©finitive avec confirmation -->
            <form action="{{ url_for('supprimer_definitif_vente', id=vente.id) }}" method="POST" 
                  class="form-supprimer-def" data-nom="{{ vente.produit.nom }}" style="display:inline;">
              <button type="submit" class="btn btn-danger btn-sm">Supprimer d√©finitivement</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="alert alert-info">Aucune vente dans la corbeille.</div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.querySelectorAll('.form-supprimer-def').forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const nom = this.dataset.nom;

      Swal.fire({
        icon: 'warning',
        title: '√ätes-vous s√ªr ?',
        html: `La vente du produit "<strong>${nom}</strong>" sera <u>d√©finitivement supprim√©e</u>.`,
        showCancelButton: true,
        confirmButtonText: 'Oui, supprimer',
        cancelButtonText: 'Annuler',
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        focusCancel: true
      }).then((result) => {
        if (result.isConfirmed) {
          this.submit();
        }
      });
    });
  });
</script>
{% endblock %}
